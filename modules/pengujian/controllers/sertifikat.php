 
<?php
/* Generated by Softdev 2 ERP Module Generator 2019-04-01 00:31:21 */
/* Location: ./modules/pengujian/controllers/sertifikat.php */
/* Please DO NOT modify this information : */ 


/*
    Preparation 
    1. untuk load view halaman upload , file berada pada folder partial;
    2. lib auth untuk fungsi check modul



    Parameter need to be change after generate 
    1. FOLDER_APP => change to folder name where this controllers should be there
    2. Static Dropdown => change value for option
    3. Dynamic Dropdown => Change query for option

    Table Sample 
    test.item && test.item_file_upload




*/
 


 
if ( ! defined('BASEPATH')) exit('No direct script access allowed');
class sertifikat extends MX_Controller {
	var $masterUrl;
    function __construct() {
        parent::__construct();
         $this->load->library('auth');
        $this->db = $this->load->database('hrd',false, true);
        $this->user = $this->auth->user();

        $this->title = 'Sertifikat';
        $this->url = 'sertifikat';
        $this->urlpath = 'pengujian/'.str_replace("_","/", $this->url);

		$this->report    = $this->load->library('report');
		$url             = $_SERVER['HTTP_REFERER'];
		$company_id      = substr($url, strrpos($url, '/') + 1);
		$this->masterUrl = base_url()."processor/pengujian/sertifikat?company_id={$this->input->get('company_id')}";


        $this->maintable = 'bbpmsoh.mt01';  
        $this->main_table = $this->maintable;   
        $this->main_table_pk = 'iMt01'; 
        $datagrid['islist'] = array(
            'vNo_transaksi' => array('label'=>'No Transaksi','width'=>100,'align'=>'center','search'=>true)
            ,'vNomor' => array('label'=>'Nomor','width'=>100,'align'=>'center','search'=>true)
            ,'vNama_produsen' => array('label'=>'Nama Produsen','width'=>300,'align'=>'left','search'=>true)
            ,'iSubmit_sertifikat' => array('label'=>'Submit','width'=>100,'align'=>'center','search'=>true)
            ,'iStatus_sertifikat' => array('label'=>'Status Sertifikat','width'=>200,'align'=>'center','search'=>true)
            ,'iSphu_app' => array('label'=>'Status Bagian SPHU','width'=>200,'align'=>'center','search'=>true)
            ,'iTu_app' => array('label'=>'Status Bagian TU','width'=>200,'align'=>'center','search'=>true)
            ,'iFa_app' => array('label'=>'Status Bagian Keuangan','width'=>200,'align'=>'center','search'=>true)
        );

        $datagrid['jointableinner']=array(
            0=>array('bbpmsoh.mt06'=>'mt06.iMt01=bbpmsoh.mt01.iMt01')
            );

        $datagrid['addFields']=array(
        		'iStatus_sertifikat' => 'Status Sertifikat'
        		,'vNo_transaksi' => 'No Transaksi'
        		,'vNomor' => 'Nomor'
        		,'vLampiran' => 'Lampiran'
        		,'vPerihal' => 'Perihal'
        		,'dTanggal' => 'Tanggal'
        		,'iCustomer' => 'Customer'
                ,'vNomor1' => 'Nomor Sertifikat 1'
                ,'vNomor2' => 'Nomor Sertifikat 2'
                ,'vNoKep_menteri' => 'No Kep. Menteri'
                ,'dKep_menteri' => 'Tanggal Kep. Menteri'
                ,'vNoSk_menteri' => 'No SK Menteri'
                ,'dSk_menteri' => 'Tanggal SK Menteri'
                ,'vNama_kabalai' => 'Nama Kepala Balai'
                ,'vNip_kabalai' => 'NIP Kepala Balai'
                );
        $datagrid['isRequired']=array('all_form');
        $datagrid['shortBy']=array('mt01.dUpdated'=>'Desc');
    
        $datagrid['setQuery']=array(
                                0=>array('vall'=>'mt01.lDeleted','nilai'=>0)
                                );
        
        $this->datagrid=$datagrid;
    }

    function index($action = '') {
        $grid = new Grid;       
        $grid->setTitle($this->title);      
        $grid->setTable($this->maintable );
        $grid->setUrl($this->url);

        /*Untuk Field*/
        foreach ($this->datagrid as $kv => $vv) {
            /*Untuk List*/
            if($kv=='islist'){
                foreach ($vv as $list => $vlist) {
                    $grid->addList($list);
                    foreach ($vlist as $kdis => $vdis) {
                        if($kdis=='label'){
                            $grid->setLabel($list, $vdis);
                        }
                        if($kdis=='width'){
                            $grid->setWidth($list, $vdis);
                        }
                        if($kdis=='align'){
                            $grid->setAlign($list, $vdis);
                        }
                        if($kdis=='search' && $vdis==true){
                            $grid->setSearch($list);
                        }
                    }
                }
            }

            /*Untuk Short List*/
            if($kv=='shortBy'){
                foreach ($vv as $list => $vlist) {
                    $grid->setSortBy($list);
                    $grid->setSortOrder($vlist);
                }
            }

            if($kv=='addFields'){
                foreach ($vv as $list => $vlist) {
                    $grid->addFields($list);
                    $grid->setLabel($list, $vlist);
                }
            }

            if($kv=='inputGet'){
                foreach ($vv as $list => $vlist) {
                    $grid->setInputGet($list,$vlist);
                }
            }

            if($kv=='jointableinner'){
                foreach ($vv as $list => $vlist) {
                    foreach ($vlist as $tbjoin => $onjoin) {
                        $grid->setJoinTable($tbjoin, $onjoin, 'inner');
                    }
                }
            }
            if($kv=='setQuery'){
                foreach ($vv as $list => $vlist) {
                    $grid->setQuery($vlist['vall'], $vlist['nilai']);
                }
            }
            if($kv=='isRequired'){
                foreach ($vv as $list => $vlist) {
                    if($vlist=="all_form"){
                        foreach ($this->datagrid['addFields'] as $kfield => $vfield) {
                            $grid->setRequired($kfield);
                        }
                    }
                }
            }

        }

        //$groupnya = $this->checkgroup($this->user->gNIP);             
        //if( $groupnya['idprivi_group']== 7){
        //    $grid->setQuery('mt01.iCustomer',$this->user->gNIP );     
        //}


        $grid->changeFieldType('iSubmit_sertifikat', 'combobox','',array(''=>'--select--', 0=>'Draft', 1=>'Submit'));
        $grid->changeFieldType('iStatus_sertifikat', 'combobox','',array(''=>'', 1=>'Tidak Memenuhi Syarat', 2=>'Memenuhi Syarat'));
        $grid->changeFieldType('iType_pemohon', 'combobox','',array(''=>'--select--', 1=>'Perorangan', 2=>'Perusahaan', 3=>'Dinas'));
        $grid->changeFieldType('iSudah_beredar', 'combobox','',array(''=>'--select--', 0=>'Belum', 2=>'Sudah'));

        $grid->changeFieldType('iSphu_app', 'combobox','',array(''=>'Pilih','0'=>'Need Approval', 1=>'Reject', 2=>'Approved'));
        $grid->changeFieldType('iTu_app', 'combobox','',array(''=>'Pilih','0'=>'Need Approval', 1=>'Reject', 2=>'Approved'));
        $grid->changeFieldType('iFa_app', 'combobox','',array(''=>'Pilih','0'=>'Need Approval', 1=>'Reject', 2=>'Approved'));
        
    //set required
        $grid->setRequired('vNo_transaksi','vNomor','vLampiran','vPerihal','dTanggal','iCustomer','iType_pemohon','vNama_produsen','vAlamat_produsen','iM_tujuan_pengujian','vTujuan_pengujian_ket','vNama_sample','iM_jenis_sediaan','vJenis_sediaan_ket','iSudah_beredar','vZat_aktif','vBatch_lot','dTgl_produksi','dTgl_kadaluarsa','vNo_registrasi','vKemasan','iJumlah_diserahkan','vSuhu_penyimpanan','vPermohonan_lampiran','dTgl_ambil_sample','dTgl_serah_sample','vPimpinan_perusahaan'); 

        $grid->setRelation('iM_tujuan_pengujian','bbpmsoh.m_tujuan_pengujian','iM_tujuan_pengujian','vNama_tujuan','','inner',array('lDeleted'=>0),array('cKode'=>'asc'));
        $grid->setRelation('iM_jenis_sediaan','bbpmsoh.m_jenis_sediaan','iM_jenis_sediaan','vJenis_sediaan','','inner',array('lDeleted'=>0),array('vJenis_sediaan'=>'asc'));


        $groupnya = $this->checkgroup($this->user->gNIP);             
        if( $groupnya['idprivi_group'] == 2){
            // syaratnya pengujian semuanya beres
            //$grid->setQuery('iSubmit_sertifikat in (0)',NULL);

            $grid->setQuery('IF( (select a.iDist_virologi 
                                            from bbpmsoh.mt06 a
                                            where a.lDeleted=0 
                                            and  a.iMt01= `mt01`.iMt01 ) = 1 ,
                                                 `mt01`.iMt01 in  (select a.iMt01 
                                                                                        from bbpmsoh.mt08b a
                                                                                        where a.lDeleted=0 
                                                                                        and  a.iApprove_qa=2  ) 
                                                                                        
                            ,`mt01`.`lDeleted` =  0
                            )',NULL);  

            $grid->setQuery('IF( (select a.iDist_bakteri 
                                            from bbpmsoh.mt06 a
                                            where a.lDeleted=0 
                                            and  a.iMt01= `mt01`.iMt01 ) = 1 ,
                                                 `mt01`.iMt01 in  (select a.iMt01 
                                                                                        from bbpmsoh.mt08a a
                                                                                        where a.lDeleted=0 
                                                                                        and  a.iApprove_qa=2  ) 
                                                                                        
                            ,`mt01`.`lDeleted` =  0
                            )',NULL);  

            $grid->setQuery('IF( (select a.iDist_farmastetik 
                                            from bbpmsoh.mt06 a
                                            where a.lDeleted=0 
                                            and  a.iMt01= `mt01`.iMt01 ) = 1 ,
                                                 `mt01`.iMt01 in  (select a.iMt01 
                                                                                        from bbpmsoh.mt09 a
                                                                                        where a.lDeleted=0 
                                                                                        and  a.iApprove_qa=2  ) 
                                                                                        
                            ,`mt01`.`lDeleted` =  0
                            )',NULL);   



            if($dMt06['iDist_virologi']==1 or $dMt06['iDist_bakteri']==1 ){
                // biologik
                $templatenya = 'sertifikatB.docx';

            }else{
                // farmastetik
                $templatenya = 'sertifikatF.docx';
            }


        }else if($groupnya['idprivi_group'] == 6){

        	$grid->setQuery('iStatus_sertifikat',2);

        }else if($groupnya['idprivi_group'] == 9){
        	$grid->setQuery('iSphu_app',2);

        }else if($groupnya['idprivi_group'] == 10){
        	$grid->setQuery('iTu_app',2);

        }


        $grid->setGridView('grid');


        switch ($action) {
            case 'json':
                    $grid->getJsonData();
                    break;
            case 'view':
                    $grid->render_form($this->input->get('id'), true);
                    break;

             case 'create':
                    $grid->render_form();
                    break;
             
                case 'createproses':
                    echo $grid->saved_form();
                    break;
                  
           
            
            case 'update':
                    $grid->render_form($this->input->get('id'));
                    break;

        
            case 'updateproses':
                    echo $grid->updated_form();
                    break;
        
        
            case 'delete':
                    echo $grid->delete_row();
                    break; 
            
                //Ini Merupakan Standart Case Untuk Approve

                case 'approve':
                    echo $this->approve_view();
                    break;
                case 'approve_process':
                    echo $this->approve_process();
                    break;
                case 'reject':
                    echo $this->reject_view();
                    break;
                case 'reject_process':
                    echo $this->reject_process();
                    break;

                case 'getDataMemo':
					echo $this->getDataMemo();
				break;
                
            
                case 'download':
                    $this->download($this->input->get('file'));
                    break;
            default:
                    $grid->render_grid();
                    break;
        }
    }


    function tanggal_indo($tanggal, $cetak_hari = false)
    {
        $hari = array ( 1 =>    'Senin',
                    'Selasa',
                    'Rabu',
                    'Kamis',
                    'Jumat',
                    'Sabtu',
                    'Minggu'
                );
                
        $bulan = array (1 =>   'Januari',
                    'Februari',
                    'Maret',
                    'April',
                    'Mei',
                    'Juni',
                    'Juli',
                    'Agustus',
                    'September',
                    'Oktober',
                    'November',
                    'Desember'
                );
        $split    = explode('-', $tanggal);
        $tgl_indo = $split[2] . ' ' . $bulan[ (int)$split[1] ] . ' ' . $split[0];
        
        if ($cetak_hari) {
            $num = date('N', strtotime($tanggal));
            return $hari[$num];
        }
        return $tgl_indo;
    }

    function tanggal_english($tanggal, $cetak_hari = false)
    {
        $hari = array ( 1 =>    'Senin',
                    'Selasa',
                    'Rabu',
                    'Kamis',
                    'Jumat',
                    'Sabtu',
                    'Minggu'
                );
                
        $bulan = array (1 =>   'January',
                    'February',
                    'March',
                    'April',
                    'May',
                    'June',
                    'July',
                    'August',
                    'September',
                    'October',
                    'November',
                    'December'
                );
        $split    = explode('-', $tanggal);
        $tgl_indo = $split[2] . ' ' . $bulan[ (int)$split[1] ] . ' ' . $split[0];
        
        if ($cetak_hari) {
            $num = date('N', strtotime($tanggal));
            return $hari[$num];
        }
        return $tgl_indo;
    }




    function getDataMemo() {
		$id   = $this->input->post('id');
		$data = array();

        $cekMT6 = 'select * from bbpmsoh.mt06 a where a.iMt01 = "'.$id.'"';
        $dMt06 = $this->db->query($cekMT6)->row_array();



        if($dMt06['iDist_virologi']==1 or $dMt06['iDist_bakteri']==1 ){
            $sql = "select *,a.vNama_sample as NAMA_DAGANG,dTgl_penerimaan as TANGGAL_TERIMA_CONTOH, f.iKesimpulan as simpul8a , g.iKesimpulan as simpul8b
                from bbpmsoh.mt01 a
                join hrd.employee b on cNip=a.iCustomer
                join bbpmsoh.m_jenis_sediaan c on c.iM_jenis_sediaan=a.iM_jenis_sediaan
                left join bbpmsoh.mt02 d on d.iMt01=a.iMt01
                left join bbpmsoh.mt05 e on e.iMt01=a.iMt01

                left join bbpmsoh.mt08a f on f.iMt01 = a.iMt01
                left join bbpmsoh.mt08a_fisik f1 on f1.iMt8a = f.iMt8a

                left join bbpmsoh.mt08b g on g.iMt01 = a.iMt01
                left join bbpmsoh.mt08b_fisik g1 on g1.iMt8b = g.iMt8b

                WHERE a.iMt01 = '{$id}'";


        }else{
           $sql = "select *,a.vNama_sample as NAMA_DAGANG,dTgl_penerimaan as TANGGAL_TERIMA_CONTOH , h.iKesimpulan as simpul9
                from bbpmsoh.mt01 a
                join hrd.employee b on cNip=a.iCustomer
                join bbpmsoh.m_jenis_sediaan c on c.iM_jenis_sediaan=a.iM_jenis_sediaan
                left join bbpmsoh.mt02 d on d.iMt01=a.iMt01
                left join bbpmsoh.mt05 e on e.iMt01=a.iMt01

                left join bbpmsoh.mt09 h on h.iMt01 = a.iMt01
                left join bbpmsoh.mt09_fisik h1 on h1.iMt09 = h.iMt09

                WHERE a.iMt01 = '{$id}'";
        }


    	/*$sql = "select *,a.vNama_sample as NAMA_DAGANG,dTgl_penerimaan as TANGGAL_TERIMA_CONTOH, f.iKesimpulan as simpul8a , g.iKesimpulan as simpul8b
    			from bbpmsoh.mt01 a
    			join hrd.employee b on cNip=a.iCustomer
    			join bbpmsoh.m_jenis_sediaan c on c.iM_jenis_sediaan=a.iM_jenis_sediaan
                left join bbpmsoh.mt02 d on d.iMt01=a.iMt01
                left join bbpmsoh.mt05 e on e.iMt01=a.iMt01

                left join bbpmsoh.mt08a f on f.iMt01 = a.iMt01
                left join bbpmsoh.mt08a_fisik f1 on f1.iMt8a = f.iMt8a

                left join bbpmsoh.mt08b g on g.iMt01 = a.iMt01
                left join bbpmsoh.mt08b_fisik g1 on g1.iMt8b = g.iMt8b

                left join bbpmsoh.mt09 h on h.iMt01 = a.iMt01
                left join bbpmsoh.mt09_fisik h1 on h1.iMt09 = h.iMt09

    			WHERE a.iMt01 = '{$id}'";*/

    			
    	$query = $this->db->query($sql);

    	foreach ($query->result() as $row) {

            


    		
			$row_array['NAMA_PEMOHON']      = ucwords(strtolower($row->vName));
			$row_array['ALAMAT_PEMOHON']      = ucwords(strtolower($row->vAddress));
			$row_array['NAMA_PRODUSEN']      = ucwords(strtolower($row->vNama_produsen));
			$row_array['ALAMAT_PRODUSEN']      = ucwords(strtolower($row->vAlamat_produsen));
			$row_array['KADALUARSA']      = $this->tanggal_indo($row->dTgl_kadaluarsa, false);
			$row_array['NOREG']      = ucwords(strtolower($row->vNo_registrasi));
			$row_array['KEMASAN']      = ucwords(strtolower($row->vKemasan));
			$row_array['JENIS']      = ucwords(strtolower($row->vJenis_sediaan));
			$row_array['NOMOR_UJI']      = ucwords(strtolower($row->vNomor));

            $row_array['NAMA_DAGANG']      = ucwords(strtolower($row->NAMA_DAGANG));
            $row_array['NOMOR_TRADING']      = ucwords(strtolower($row->vBatch_lot));
            $row_array['TANGGAL_TERIMA_CONTOH']  = $this->tanggal_indo($row->TANGGAL_TERIMA_CONTOH, false);


            $row_array['ACUAN']      = ucwords(strtolower($row->vAcuan_metode_uji));


            $row_array['NOMOR1']      = ucwords(strtolower($row->vNomor1));
            $row_array['NOMOR2']      = ucwords(strtolower($row->vNomor2));

            $row_array['NOMOR3'] = ucwords(strtolower($row->vNoKep_menteri));
            $row_array['TANGGAL1']   = $this->tanggal_indo($row->dKep_menteri, false);

            $row_array['NOMOR5'] = ucwords(strtolower($row->vNoKep_menteri));
            $row_array['TANGGAL3']   = $this->tanggal_english($row->dKep_menteri, false);


            $row_array['NOMOR4']      = ucwords(strtolower($row->vNoSk_menteri));
            $row_array['TANGGAL2']   = $this->tanggal_indo($row->dSk_menteri, false);

            $row_array['NOMOR6']      = ucwords(strtolower($row->vNoSk_menteri));
            $row_array['TANGGAL4']   = $this->tanggal_english($row->dSk_menteri, false);

            $row_array['TTD1']      = ucwords(strtolower($row->vNama_kabalai));
            $row_array['TTD2']      = ucwords(strtolower($row->vNip_kabalai));


            /*mt8a start*/
                $row_array['WARNA1']      = ($row->dWarna_tanggal ? ucwords(strtolower($row->dWarna_tanggal)) : '') ;
                $row_array['WARNA2']      = ($row->vWarna_metoda ? ucwords(strtolower($row->vWarna_metoda)) : '') ;
                $row_array['WARNA3']      = ($row->vWarna ? ucwords(strtolower($row->vWarna)) : '') ;
                $row_array['WARNA4']      = ($row->vWarna_mutu ? ucwords(strtolower($row->vWarna_mutu)) : '') ;
                

                $row_array['BAU1']      = '';
                $row_array['BAU2']      = '';
                $row_array['BAU3']      = '';
                $row_array['BAU4']      = '';



                $row_array['PARTIKEL_ASING1']      = ($row->vWarna_mutu ? ucwords(strtolower($row->dAsing_tanggal)) : '') ;
                $row_array['PARTIKEL_ASING2']      = ($row->vAsing_metoda ? ucwords(strtolower($row->vAsing_metoda)) : '');
                $row_array['PARTIKEL_ASING3']      = ($row->vAsing ? ucwords(strtolower($row->vAsing)) : '') ;
                $row_array['PARTIKEL_ASING4']      = ($row->vAsing_mutu ? ucwords(strtolower($row->vAsing_mutu)) : '') ;

                $row_array['HOMOGENITAS1']      = ($row->dHomogen_tanggal ? ucwords(strtolower($row->dHomogen_tanggal)) : '') ;
                $row_array['HOMOGENITAS2']      = ($row->vHomogen_metoda ? ucwords(strtolower($row->vHomogen_metoda)) : '') ;
                $row_array['HOMOGENITAS4']      = ($row->vHomogen_mutu ? ucwords(strtolower($row->vHomogen_mutu)) : '') ;
                $row_array['HOMOGENITAS3']      = ($row->vHomogen ? ucwords(strtolower($row->vHomogen)) : '') ;

                $row_array['KEVAKUMAN1']      = ($row->dVakum_tanggal ? ucwords(strtolower($row->dVakum_tanggal)) : '') ;
                $row_array['KEVAKUMAN2']      = ($row->vVakum_metoda ? ucwords(strtolower($row->vVakum_metoda)) : '') ;
                $row_array['KEVAKUMAN4']      = ($row->vVakum_mutu ? ucwords(strtolower($row->vVakum_mutu)) : '') ;
                $row_array['KEVAKUMAN3']      = ($row->vVakum ? ucwords(strtolower($row->vVakum)) : '') ;

                $row_array['KELEMBABAN1']      = ($row->dLembab_tanggal ? ucwords(strtolower($row->dLembab_tanggal)) : '') ;
                $row_array['KELEMBABAN2']      = ($row->vLembab_metoda ? ucwords(strtolower($row->vLembab_metoda)) : '') ;
                $row_array['KELEMBABAN4']      = ($row->vLembab_mutu ? ucwords(strtolower($row->vLembab_mutu)) : '') ;
                $row_array['KELEMBABAN3']      = ($row->vLembab ? ucwords(strtolower($row->vLembab)) : '') ;

                $row_array['KEMURNIAN1']      = ($row->dMurni_tanggal ? ucwords(strtolower($row->dMurni_tanggal)) : '') ;
                $row_array['KEMURNIAN2']      = ($row->vMurni_metoda ? ucwords(strtolower($row->vMurni_metoda)) : '') ;
                $row_array['KEMURNIAN4']      = ($row->vMurni_mutu ? ucwords(strtolower($row->vMurni_mutu)) : '') ;
                $row_array['KEMURNIAN3']      = ($row->vMurni_37 ? ucwords(strtolower($row->vMurni_37)) : '') ;

                $row_array['STERIL1']      = ($row->dSteril_tanggal ? ucwords(strtolower($row->dSteril_tanggal)) : '') ;
                $row_array['STERIL2']      = ($row->vSteril_metoda ? ucwords(strtolower($row->vSteril_metoda)) : '') ;
                $row_array['STERIL4']      = ($row->vSteril_mutu ? ucwords(strtolower($row->vSteril_mutu)) : '') ;
                $row_array['STERIL3']      = ($row->vSteril_37 ? ucwords(strtolower($row->vSteril_37)) : '') ;

                $row_array['MYCROPLASMA1']      = ($row->dKontaminasi_tanggal ? ucwords(strtolower($row->dKontaminasi_tanggal)) : '') ;
                $row_array['MYCROPLASMA2']      = ($row->vKontaminasi_metoda ? ucwords(strtolower($row->vKontaminasi_metoda)) : '') ;
                $row_array['MYCROPLASMA3']      = ($row->vKontaminasi_mico ? ucwords(strtolower($row->vKontaminasi_mico)) : '') ;
                $row_array['MYCROPLASMA4']      = ($row->vKontaminasi_mutu ? ucwords(strtolower($row->vKontaminasi_mutu)) : '') ;

                $row_array['SALMONELLA1']      = ($row->dKontaminasi_tanggal ? ucwords(strtolower($row->dKontaminasi_tanggal)) : '') ;
                $row_array['SALMONELLA2']      = ($row->vKontaminasi_metoda ? ucwords(strtolower($row->vKontaminasi_metoda)) : '') ;
                $row_array['SALMONELLA3']      = ($row->vKontaminasi_salmon ? ucwords(strtolower($row->vKontaminasi_salmon)) : '') ;
                $row_array['SALMONELLA4']      = ($row->vKontaminasi_mutu ? ucwords(strtolower($row->vKontaminasi_mutu)) : '') ;

                $row_array['COLI1']      = ($row->dKontaminasi_tanggal ? ucwords(strtolower($row->dKontaminasi_tanggal)) : '') ;
                $row_array['COLI2']      = ($row->vKontaminasi_metoda ? ucwords(strtolower($row->vKontaminasi_metoda)) : '') ;
                $row_array['COLI3']      = ($row->vKontaminasi_jamur ? ucwords(strtolower($row->vKontaminasi_jamur)) : '') ;
                $row_array['COLI4']      = ($row->vKontaminasi_mutu ? ucwords(strtolower($row->vKontaminasi_mutu)) : '') ;

                $row_array['JAMUR1']      = ($row->dKontaminasi_tanggal ? ucwords(strtolower($row->dKontaminasi_tanggal)) : '') ;
                $row_array['JAMUR2']      = ($row->vKontaminasi_metoda ? ucwords(strtolower($row->vKontaminasi_metoda)) : '') ;
                $row_array['JAMUR3']      = ($row->vKontaminasi_coli ? ucwords(strtolower($row->vKontaminasi_coli)) : '') ;
                $row_array['JAMUR4']      = ($row->vKontaminasi_mutu ? ucwords(strtolower($row->vKontaminasi_mutu)) : '') ;

                $row_array['ORGANISME1']      = ($row->dKontaminasi_tanggal ? ucwords(strtolower($row->dKontaminasi_tanggal)) : '') ;
                $row_array['ORGANISME2']      = ($row->vKontaminasi_metoda ? ucwords(strtolower($row->vKontaminasi_metoda)) : '') ;
                $row_array['ORGANISME3']      = ($row->vKontaminasi_lain ? ucwords(strtolower($row->vKontaminasi_lain)) : '') ;
                $row_array['ORGANISME4']      = ($row->vKontaminasi_mutu ? ucwords(strtolower($row->vKontaminasi_mutu)) : '') ;

                $row_array['BAKTERI1']      = ($row->dKandungan_tanggal ? ucwords(strtolower($row->dKandungan_tanggal)) : '') ;
                $row_array['BAKTERI2']      = ($row->vKandungan_metoda ? ucwords(strtolower($row->vKandungan_metoda)) : '') ;
                $row_array['BAKTERI3']      = ($row->vKandungan ? ucwords(strtolower($row->vKandungan)) : '') ;
                $row_array['BAKTERI4']      = ($row->vKandungan_mutu ? ucwords(strtolower($row->vKandungan_mutu)) : '') ;

                $row_array['IDENTITAS1']      = ($row->dIdentitas_tanggal ? ucwords(strtolower($row->dIdentitas_tanggal)) : '') ;
                $row_array['IDENTITAS2']      = ($row->vIdentitas_metoda ? ucwords(strtolower($row->vIdentitas_metoda)) : '') ;
                $row_array['IDENTITAS3']      = ($row->vIdentitas ? ucwords(strtolower($row->vIdentitas)) : '') ;
                $row_array['IDENTITAS4']      = ($row->vIdentitas_mutu ? ucwords(strtolower($row->vIdentitas_mutu)) : '') ;

                $row_array['INAKTIF1']      = ($row->dInaktivasi_tanggal ? ucwords(strtolower($row->dInaktivasi_tanggal)) : '') ;
                $row_array['INAKTIF2']      = ($row->vInaktivasi_metoda ? ucwords(strtolower($row->vInaktivasi_metoda)) : '') ;
                $row_array['INAKTIF3']      = ($row->vInaktivasi_jenis ? ucwords(strtolower($row->vInaktivasi_jenis)) : '') ;
                $row_array['INAKTIF4']      = ($row->vInaktivasi_mutu ? ucwords(strtolower($row->vInaktivasi_mutu)) : '') ;

                $row_array['TOXIC1']      = ($row->dPatologi_tanggal ? ucwords(strtolower($row->dPatologi_tanggal)) : '') ;
                $row_array['TOXIC2']      = ($row->vPatologi_metoda ? ucwords(strtolower($row->vPatologi_metoda)) : '') ;
                $row_array['TOXIC3']      = ($row->vPatologi ? ucwords(strtolower($row->vPatologi)) : '') ;
                $row_array['TOXIC4']      = ($row->vPatologi_mutu ? ucwords(strtolower($row->vPatologi_mutu)) : '') ;

                $row_array['KEAMANAN1']      = ($row->vPatologi_perlakuan ? ucwords(strtolower($row->vPatologi_perlakuan)) : '') ;

                $row_array['POTENSI']      = ($row->vPotensi_perlakuan ? ucwords(strtolower($row->vPotensi_perlakuan)) : '') ;
                $row_array['POTENSI1']      = ($row->dPotensi_tanggal ? ucwords(strtolower($row->dPotensi_tanggal)) : '') ;
                $row_array['POTENSI2']      = ($row->vPotensi_metoda ? ucwords(strtolower($row->vPotensi_metoda)) : '') ;
                $row_array['POTENSI3']      = ($row->vPotensi ? ucwords(strtolower($row->vPotensi)) : '') ;
                $row_array['POTENSI4']      = ($row->vPotensi_mutu ? ucwords(strtolower($row->vPotensi_mutu)) : '') ;

                $row_array['LAIN1']      = ($row->dLain_tanggal ? ucwords(strtolower($row->dLain_tanggal)) : '') ;
                $row_array['LAIN2']      = ($row->vLain_metoda ? ucwords(strtolower($row->vLain_metoda)) : '') ;
                $row_array['LAIN3']      = ($row->vLain ? ucwords(strtolower($row->vLain)) : '') ;
                $row_array['LAIN4']      = ($row->vLain_mutu ? ucwords(strtolower($row->vLain_mutu)) : '') ;


                $cekMT6 = 'select * from bbpmsoh.mt06 a where a.iMt01 = "'.$row->iMt01.'"';
                $dMt06 = $this->db->query($cekMT6)->row_array();


                $nilai ="";
                if($dMt06['iDist_virologi']==1 or $dMt06['iDist_bakteri']==1 ){
                   

                    if($row->simpul8a <> "" ||  $row->simpul8a <> 0){
                        if($row->simpul8a == 1){
                            $nilai .= 'Kesimpulan Uji Umum : Tidak memenuhi syarat';
                        }else{
                            $nilai .= 'Kesimpulan Uji Umum : Memenuhi Syarat';
                        }
                        

                    }

                    if($row->simpul8b <> "" ||  $row->simpul8b <> 0){
                        if($row->simpul8b == 1){
                            $nilai .= ', Kesimpulan Uji Khusus : Tidak memenuhi syarat';
                        }else{
                            $nilai .= ', Kesimpulan Uji Khusus : Memenuhi Syarat';
                        }
                        

                    }

                }else{

                    /*farma*/

                     if($row->simpul9 <> "" ||  $row->simpul9 <> 0){
                        if($row->simpul9 == 1){
                            $nilai .= 'Tidak memenuhi syarat';
                        }else{
                            $nilai .= 'Memenuhi Syarat';
                        }
                        

                    }



                    $row_array['KELARUTAN1']      = ($row->dKelarutan_tanggal ? ucwords(strtolower($row->dKelarutan_tanggal)) : '') ;
                    $row_array['KELARUTAN2']      = ($row->vKelarutan_metoda ? ucwords(strtolower($row->vKelarutan_metoda)) : '') ;
                    $row_array['KELARUTAN3']      = ($row->vKelarutan ? ucwords(strtolower($row->vKelarutan)) : '') ;
                    $row_array['KELARUTAN4']      = ($row->vKelarutan_mutu ? ucwords(strtolower($row->vKelarutan_mutu)) : '') ;

                    $row_array['HOMOGENITAS1']      = ($row->dSeragam_tanggal ? ucwords(strtolower($row->dSeragam_tanggal)) : '') ;
                    $row_array['HOMOGENITAS2']      = ($row->vSeragam_metoda ? ucwords(strtolower($row->vSeragam_metoda)) : '') ;
                    $row_array['HOMOGENITAS4']      = ($row->vSeragam_mutu ? ucwords(strtolower($row->vSeragam_mutu)) : '') ;
                    $row_array['HOMOGENITAS3']      = ($row->vSeragam ? ucwords(strtolower($row->vSeragam)) : '') ;

                    $row_array['KEASAMAN1']      = ($row->dPh_tanggal ? ucwords(strtolower($row->dPh_tanggal)) : '') ;
                    $row_array['KEASAMAN2']      = ($row->vPh_metoda ? ucwords(strtolower($row->vPh_metoda)) : '') ;
                    $row_array['KEASAMAN4']      = ($row->vPh_mutu ? ucwords(strtolower($row->vPh_mutu)) : '') ;
                    $row_array['KEASAMAN3']      = ($row->vPh ? ucwords(strtolower($row->vPh)) : '') ;

                    $row_array['STERIL1']      = ($row->dSteril37_tanggal ? ucwords(strtolower($row->dSteril37_tanggal)) : '') ;
                    $row_array['STERIL2']      = ($row->vSteril37_metoda ? ucwords(strtolower($row->vSteril37_metoda)) : '') ;
                    $row_array['STERIL4']      = ($row->vSteril37_mutu ? ucwords(strtolower($row->vSteril37_mutu)) : '') ;
                    $row_array['STERIL3']      = ($row->vSteril_37 ? ucwords(strtolower($row->vSteril_37)) : '') ;

                    $row_array['STERIL1a']      = ($row->dSteril22_tanggal ? ucwords(strtolower($row->dSteril22_tanggal)) : '') ;
                    $row_array['STERIL2a']      = ($row->vSteril22_metoda ? ucwords(strtolower($row->vSteril22_metoda)) : '') ;
                    $row_array['STERIL4a']      = ($row->vSteril22_mutu ? ucwords(strtolower($row->vSteril22_mutu)) : '') ;
                    $row_array['STERIL3a']      = ($row->vSteril22 ? ucwords(strtolower($row->vSteril22)) : '') ;


                    $row_array['TOXIC1']      = ($row->dToksis_tanggal ? ucwords(strtolower($row->dToksis_tanggal)) : '') ;
                    $row_array['TOXIC2']      = ($row->vToksis_metoda ? ucwords(strtolower($row->vToksis_metoda)) : '') ;
                    $row_array['TOXIC3']      = ($row->vToksis ? ucwords(strtolower($row->vToksis)) : '') ;
                    $row_array['TOXIC4']      = ($row->vToksis_mutu ? ucwords(strtolower($row->vToksis_mutu)) : '') ;

                    $row_array['PIROGENITAS1']      = ($row->dPirogen_tanggal ? ucwords(strtolower($row->dPirogen_tanggal)) : '') ;
                    $row_array['PIROGENITAS2']      = ($row->vPirogen_metoda ? ucwords(strtolower($row->vPirogen_metoda)) : '') ;
                    $row_array['PIROGENITAS3']      = ($row->vPirogen ? ucwords(strtolower($row->vPirogen)) : '') ;
                    $row_array['PIROGENITAS4']      = ($row->vPirogen_mutu ? ucwords(strtolower($row->vPirogen_mutu)) : '') ;

                    
                    $row_array['KADAR']      = ($row->vPotensi_object ? ucwords(strtolower($row->vPotensi_object)) : '') ;
                    $row_array['KADAR1']      = ($row->dPotensi_tanggal ? ucwords(strtolower($row->dPotensi_tanggal)) : '') ;
                    $row_array['KADAR2']      = ($row->vPotensi_metoda ? ucwords(strtolower($row->vPotensi_metoda)) : '') ;
                    $row_array['KADAR3']      = ($row->vPotensi ? ucwords(strtolower($row->vPotensi)) : '') ;
                    $row_array['KADAR4']      = ($row->vPotensi_mutu ? ucwords(strtolower($row->vPotensi_mutu)) : '') ;

                    


                  
                }


                



                $row_array['PENILAIAN']      = $nilai;


                
                


            /*mt8a end*/



			

			array_push($data, $row_array);
    	}

    	echo json_encode($data);
    }


    function checkgroup($nip){
        $sql = "select *,a.idprivi_group,a.vNamaGroup 
                from erp_privi.privi_group_pt_app a 
                join erp_privi.privi_apps b on b.idprivi_apps=a.idprivi_apps
                join erp_privi.privi_authlist c on c.idprivi_apps=b.idprivi_apps and c.idprivi_group=a.iID_GroupApp
                where 
                b.idprivi_apps=130
                and 
                c.cNIP='".$nip."' ";
        $ret = $this->db->query($sql)->row_array();
        return $ret;
    }




    //Jika Ingin Menambahkan Seting grid seperti button edit enable dalam kondisi tertentu
     
    function listBox_Action($row, $actions) {
        if ($row->iFa_app<>0) { 
                unset($actions['edit']);
        }
        return $actions;
    } 
    

                        function insertBox_sertifikat_vNo_transaksi($field, $id) {
                            $return = 'Auto Generated';
                            $return .= '<input type="hidden" name="isdraft"    class="input_rows1 " size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vNo_transaksi($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="hidden" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal  required" size="8" value="'.$value.'"/>';
                                    $return .= '<input type="hidden" name="isdraft"    class="input_rows1 " size="30"  />';
                                    $return .= $value;


                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_vNomor($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vNomor($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="hidden" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal  required" size="8" value="'.$value.'"/>';
                                    $return .= $value;

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_vLampiran($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vLampiran($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="hidden" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal  required" size="8" value="'.$value.'"/>';
                                    $return .= $value;

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_vPerihal($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vPerihal($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="hidden" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal  required" size="8" value="'.$value.'"/>';
                                    $return .= $value;

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_dTanggal($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal required" size="8" />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_dTanggal($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="hidden" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal  required" size="8" value="'.$value.'"/>';
                                    $return .= $value; 

                                }
                                
                            return $return;
                        }


                        function insertBox_sertifikat_dKep_menteri($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal required" size="8" />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_dKep_menteri($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal  required" size="8" value="'.$value.'"/>';
                                    

                                }
                                
                            return $return;
                        }



                        function insertBox_sertifikat_dSk_menteri($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal required" size="8" />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_dSk_menteri($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal  required" size="8" value="'.$value.'"/>';
                                    

                                }
                                
                            return $return;
                        }


                        
                        function insertBox_sertifikat_iCustomer($field, $id) {
                            $groupnya = $this->checkgroup($this->user->gNIP);             
                           
                            if($groupnya['idprivi_group'] == 7){
                                 $this->db->select("*")
                                    ->from("hrd.employee")
                                    ->where("iDivisionID",7)
                                    ->where("cNip",$this->user->gNIP)
                                    ->where("iVerifikasi",1);
                            }else{
                                $this->db->select("*")
                                    ->from("hrd.employee")
                                    ->where("iDivisionID",7)
                                    ->where("iVerifikasi",1);
                            }
                            


                            $fo=$this->db->get()->result_array();
                            $return="<select id='".$id."' name='".$field."' class='required'>";
                            $return.="<option value=''>---Pilih---</option>";
                            foreach ($fo as $kf => $vvf) {
                                $return.="<option value='".$vvf['cNip']."'>".$vvf["vName_company"].' - '.$vvf["vName"]."</option>";
                            }
                            $return.="</select>";
                            return $return;
                        }
                        
                        function updateBox_sertifikat_iCustomer($field, $id, $value, $rowData) {
                           		$this->db->select("*")
                                        ->from("hrd.employee")
                                        ->where("cNip",$value);
                                $fo=$this->db->get()->row_array();
                            
                            $return = '<input type="hidden" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal  required" size="8" value="'.$value.'"/>';
                            $return .= $fo['vName'].' - '.$fo['vName_company'];

                            return $return;
                        }

                        function insertBox_sertifikat_iCustomer1($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_iCustomer1($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_vNama_produsen($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vNama_produsen($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_vAlamat_produsen($field, $id) {
                            $return = '<textarea name="'.$field.'" id="'.$id.'" class="required" style="width: 240px; height: 75px;" size="250" maxlength ="250"></textarea>';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vAlamat_produsen($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= '<label title="Note">'.nl2br($value).'</label>'; 
                                }else{ 
                                    $return = '<textarea name="'.$field.'" id="'.$id.'" class="required" style="width: 240px; height: 75px;" size="250" maxlength ="250">'.nl2br($value).'</textarea>';

                                }
                                
                            return $return;
                        }
                        
                       /* function insertBox_sertifikat_iM_tujuan_pengujian($field, $id) {
                            $this->db->select("*")
                                    ->from("bbpmsoh.m_tujuan_pengujian")
                                    ->where("lDeleted",0);
                            $fo=$this->db->get()->result_array();
                            $return="<select id='".$id."' name='".$field."' class='required'>";
                            $return.="<option value=''>---Pilih---</option>";
                            foreach ($fo as $kf => $vvf) {
                                $return.="<option value='".$vvf['iM_tujuan_pengujian']."'>".$vvf["vNama_tujuan"]."</option>";
                            }
                            $return.="</select>";
                            return $return;
                        }
                        
                        function updateBox_sertifikat_iM_tujuan_pengujian($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 angka required" size="10" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }*/
                        
                        function insertBox_sertifikat_vTujuan_pengujian_ket($field, $id) {
                            $return = '<textarea name="'.$field.'" id="'.$id.'" class="required" style="width: 240px; height: 75px;" size="250" maxlength ="250"></textarea>';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vTujuan_pengujian_ket($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= '<label title="Note">'.nl2br($value).'</label>'; 
                                }else{ 
                                    $return = '<textarea name="'.$field.'" id="'.$id.'" class="required" style="width: 240px; height: 75px;" size="250" maxlength ="250">'.nl2br($value).'</textarea>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_vNama_sample($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vNama_sample($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        /*function insertBox_sertifikat_iM_jenis_sediaan($field, $id) {
                             $this->db->select("*")
                                    ->from("bbpmsoh.m_jenis_sediaan")
                                    ->where("lDeleted",0);
                            $fo=$this->db->get()->result_array();
                            $return="<select id='".$id."' name='".$field."' class='required'>";
                            $return.="<option value=''>---Pilih---</option>";
                            foreach ($fo as $kf => $vvf) {
                                $return.="<option value='".$vvf['iM_jenis_sediaan']."'>".$vvf["vJenis_sediaan"]."</option>";
                            }
                            $return.="</select>";
                            return $return;
                        }
                        
                        function updateBox_sertifikat_iM_jenis_sediaan($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 angka required" size="10" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_iSudah_beredar($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 angka required" size="10" />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_iSudah_beredar($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 angka required" size="10" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }*/
                        
                        function insertBox_sertifikat_vZat_aktif($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vZat_aktif($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_vBatch_lot($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vBatch_lot($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_dTgl_produksi($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal required" size="8" />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_dTgl_produksi($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal  required" size="8" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_dTgl_kadaluarsa($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal required" size="8" />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_dTgl_kadaluarsa($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal  required" size="8" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_vNo_registrasi($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vNo_registrasi($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_vKemasan($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vKemasan($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_iJumlah_diserahkan($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 angka required" size="10" />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_iJumlah_diserahkan($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 angka required" size="10" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_vSuhu_penyimpanan($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vSuhu_penyimpanan($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_vPermohonan_lampiran($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vPermohonan_lampiran($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_dTgl_ambil_sample($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal required" size="8" />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_dTgl_ambil_sample($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal  required" size="8" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_dTgl_serah_sample($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal required" size="8" />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_dTgl_serah_sample($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 tanggal  required" size="8" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_vPimpinan_perusahaan($field, $id) {
                            $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1 required" size="30"  />';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_vPimpinan_perusahaan($field, $id, $value, $rowData) {
                                if ($this->input->get('action') == 'view') {
                                     $return= $value; 
                                }else{ 
                                    $return = '<input type="text" name="'.$field.'"  id="'.$id.'"  class="input_rows1  required" size="30" value="'.$value.'"/>';

                                }
                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_iSubmit($field, $id) {
                            $return = '-';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_iSubmit($field, $id, $value, $rowData) {
                            $arr=array(0=>"Draft",1=>"Submited");
                            $return=isset($arr[$value])?$arr[$value]:"-";                                
                            return $return;
                        }
                        
                        function insertBox_sertifikat_iApprove($field, $id) {
                            $return = '-';
                            return $return;
                        }
                        
                        function updateBox_sertifikat_iApprove($field, $id, $value, $rowData) {
                            $arr=array(0=>"Waiting Approval",1=>"Rejected",2=>"Approved");
                            $return=isset($arr[$value])?$arr[$value]:"-";                                
                            return $return;
                        }
                        
        //Ini Merupakan Standart Approve yang digunakan di erp
        function approve_view() {
            $echo = '<script type="text/javascript">
                         function submit_ajax(form_id) {
                            return $.ajax({
                                url: $("#"+form_id).attr("action"),
                                type: $("#"+form_id).attr("method"),
                                data: $("#"+form_id).serialize(),
                                success: function(data) {
                                    var o = $.parseJSON(data);
                                    var last_id = o.last_id;
                                    var url = "'.base_url().'processor/pengujian/sertifikat";                             
                                    if(o.status == true) { 
                                        $("#alert_dialog_form").dialog("close");
                                             $.get(url+"?action=update&id="+last_id, function(data) {
                                             $("div#form_sertifikat").html(data);
                                             
                                        });
                                        
                                    }
                                        reload_grid("grid_sertifikat");
                                }
                                
                             })
                         }
                     </script>';
            $echo .= '<h1>Approve</h1><br />';
            $echo .= '<form id="form_sertifikat_approve" action="'.base_url().'processor/pengujian/sertifikat?action=approve_process" method="post">';
            $echo .= '<div style="vertical-align: top;">';
            $echo .= 'Remark : 
                    <input type="hidden" name="iMt01" value="'.$this->input->get('iMt01').'" />
                    <input type="hidden" name="modul_id" value="'.$this->input->get('modul_id').'" />
                    <input type="hidden" name="level" value="'.$this->input->get('level').'" />
                    <input type="hidden" name="group_id" value="'.$this->input->get('group_id').'" />
                    
                    <textarea name="vRemark"></textarea>
            <button type="button" onclick="submit_ajax(\'form_sertifikat_approve\')">Approve</button>';
                
            $echo .= '</div>';
            $echo .= '</form>';
            return $echo;
        } 

        function approve_process() {
            $post = $this->input->post();
            $cNip= $this->user->gNIP;
            $vName= $this->user->gName;
            $iMt01 = $post['iMt01'];
            $vRemark = $post['vRemark'];
            $lvl = $post['level'];

            $qsql="
                        select * 
                        from bbpmsoh.mt01 a 
                        join hrd.employee b on b.cNip=a.iCustomer
                        join bbpmsoh.m_tujuan_pengujian c on c.iM_tujuan_pengujian=a.iM_tujuan_pengujian
                        where a.lDeleted=0 
                        and a.iMt01 = '".$iMt01."'

                ";
            $rsql = $this->db->query($qsql)->row_array();

            $subject = '';
            //Letakan Query Update approve disini
            if($lvl==1){
            	$dataupdate['cSphu_app']= $this->user->gNIP;
		        $dataupdate['dSphu_app']= date('Y-m-d H:i:s');
		        $dataupdate['vSphu_app']= $post['vRemark'];
		        $dataupdate['iSphu_app']= 2;

                $subject = 'e-Pengujian -> Approve SPHU Sertifikat '.$rsql['vNo_transaksi'];
                $precontent = 'Admin SPHU telah melakukan Approval Permintaan Permohonan Kontrak Pengujian Mutu Obat Hewan baru';
                $to = '0';


            }else if($lvl==2){
            	$dataupdate['cTu_app']= $this->user->gNIP;
		        $dataupdate['dTu_app']= date('Y-m-d H:i:s');
		        $dataupdate['vTu_app']= $post['vRemark'];
		        $dataupdate['iTu_app']= 2;

                $to = $rsql['iCustomer'] ;                        
                $subject = 'e-Pengujian -> Approve TU Sertifikat '.$rsql['vNo_transaksi'];
                $precontent = 'Admin TU telah melakukan Approval Permintaan Permohonan Kontrak Pengujian Mutu Obat Hewan baru';
                

            }else{
            	$dataupdate['cFa_app']= $this->user->gNIP;
		        $dataupdate['dFa_app']= date('Y-m-d H:i:s');
		        $dataupdate['vFa_app']= $post['vRemark'];
		        $dataupdate['iFa_app']= 2;

                $to = $rsql['iCustomer'] ;                        
                $subject = 'e-Pengujian -> Confirm Admin Keuangan Sertifikat '.$rsql['vNo_transaksi'];
                $precontent = 'Admin Keuangan telah melakukan Konfirmasi Permintaan Permohonan Kontrak Pengujian Mutu Obat Hewan baru';
            }
	        
	        $updet = $this->db->where('iMt01',$post['iMt01'])->update('bbpmsoh.mt01',$dataupdate);

            if($updet){

                if($subject <> ""){
                    $qsql="
                            select * 
                            from bbpmsoh.mt01 a 
                            join hrd.employee b on b.cNip=a.iCustomer
                            join bbpmsoh.m_tujuan_pengujian c on c.iM_tujuan_pengujian=a.iM_tujuan_pengujian
                            where a.lDeleted=0 
                            and a.iMt01 = '".$iMt01."'

                    ";
                    $rsql = $this->db->query($qsql)->row_array();

                    $iAm = $this->whoAmI($this->user->gNIP);

                    
                    $cc = $iAm['cNip'] ;

                    $sqlEmpAr = 'select * from bbpmsoh.sysparam a where a.vVariable="MAIL_SERTIFIKAT_APP"';
                    $dEmpAr =  $this->db->query($sqlEmpAr)->row_array();
                    $sq= $dEmpAr['vContent'];
                    $dataTO = $this->db->query($sq)->result_array();

                    
                    foreach ($dataTO as $toto) {
                        $to .=','.$toto['cNIP'];
                    }

                    $bccMail = 'select * from bbpmsoh.sysparam a where a.vVariable="MAIL_BCC"';
                    $dBcc =  $this->db->query($bccMail)->row_array();

                    $to = $to;
                    $cc = $this->user->gNIP.','.$dBcc['vContent'];

                    
                    $content="
                            <p>Diberitahukan bahwa ".$precontent." yang membutuhkan Follow up, dengan rincian sebagai berikut : <p>
                            <br><br>  
                            <table border='1' style='width: 750px;border-collapse: collapse;'>
                                <tr>
                                        <td style='width: 30%;'><b>Nomor Transaksi</b></td>
                                        <td> : ".$rsql['vNo_transaksi']."</td>
                                </tr>

                                <tr>
                                        <td style='width: 30%;'><b>Nama Pemohon</b></td>
                                        <td> : ".$rsql['cNip'].' || '.$rsql['vName']."</td>
                                </tr>


                                <tr>
                                        <td><b>No Permintaan</b></td>
                                        <td> : ".$rsql['vNomor']."</td>
                                </tr> 
                                <tr>
                                        <td><b>Perihal</b></td>
                                        <td> :".$rsql['vPerihal']."</td>
                                </tr> 

                                <tr>
                                        <td><b>Nama Perusahaan</b></td>
                                        <td> :".$rsql['vName_company']."</td>
                                </tr> 

                                <tr>
                                        <td><b>Alamat</b></td>
                                        <td> : ".nl2br($rsql['vAddress_company'])."</td>
                                </tr>

                                <tr>
                                        <td><b>Nama Produsen</b></td>
                                        <td> :".$rsql['vNama_produsen']."</td>
                                </tr> 

                                <tr>
                                        <td><b>Alamat Produsen</b></td>
                                        <td> : ".nl2br($rsql['vAlamat_produsen'])."</td>
                                </tr>

                                <tr>
                                        <td><b>Tujuan Pengujian Mutu</b></td>
                                        <td> : ".$rsql['vNama_tujuan']."</td>
                                </tr>

                                <tr>
                                        <td><b>Nama Sample</b></td>
                                        <td> : ".$rsql['vNama_sample']."</td>
                                </tr>  
                                <tr>
                                        <td><b>Status</b></td>
                                        <td> : Approve</td>
                                </tr>

                                <tr>
                                        <td><b>Lokasi Modul</b></td>
                                        <td> e-Pengujian -> Transaksi -> Sertifikat</td>
                                </tr>
                                
                            </table> 

                        <br/> <br/>
                        Demikian, mohon segera follow up  pada aplikasi e-Pengujian. Terimakasih.<br><br><br>
                        Post Master"; 

                        $this->sess_auth->send_message_erp($this->uri->segment_array(),$to, $cc, $subject, $content);
                }

            }

            $data['status']  = true;
            $data['last_id'] = $post['iMt01'];
            return json_encode($data);
        }
    


        //Ini Merupakan Standart Reject yang digunakan di erp
        function reject_view() {
            $echo = '<script type="text/javascript">
                         function submit_ajax(form_id) {
                            var remark = $("#sertifikat_remark").val();
                            if (remark=="") {
                                alert("Remark tidak boleh kosong ");
                                return
                            }

                            return $.ajax({
                                url: $("#"+form_id).attr("action"),
                                type: $("#"+form_id).attr("method"),
                                data: $("#"+form_id).serialize(),
                                success: function(data) {
                                    var o = $.parseJSON(data);
                                    var last_id = o.last_id;
                                    var url = "'.base_url().'processor/pengujian/sertifikat";                             
                                    if(o.status == true) { 
                                        $("#alert_dialog_form").dialog("close");
                                             $.get(url+"?action=update&id="+last_id, function(data) {
                                             $("div#form_sertifikat").html(data);
                                             
                                        });
                                        
                                    }
                                        reload_grid("grid_sertifikat");
                                }
                                
                             })
                         }
                     </script>';
            $echo .= '<h1>Reject</h1><br />';
            $echo .= '<form id="form_sertifikat_reject" action="'.base_url().'processor/pengujian/sertifikat?action=reject_process" method="post">';
            $echo .= '<div style="vertical-align: top;">';
            $echo .= 'Remark : 
                    <input type="hidden" name="iMt01" value="'.$this->input->get('iMt01').'" />
                    <input type="hidden" name="modul_id" value="'.$this->input->get('modul_id').'" />
                    <input type="hidden" name="level" value="'.$this->input->get('lvl').'" />
                    <input type="hidden" name="group_id" value="'.$this->input->get('group_id').'" />
                    
                    <textarea name="vRemark" id="reject_sertifikat_remark"></textarea>
            <button type="button" onclick="submit_ajax(\'form_sertifikat_reject\')">Reject</button>';
                
            $echo .= '</div>';
            $echo .= '</form>';
            return $echo;
        }


        
        function reject_process() {
            $post = $this->input->post();
            $cNip= $this->user->gNIP;
            $vName= $this->user->gName;
            $iMt01 = $post['iMt01'];
            $vRemark = $post['vRemark'];
            $lvl = $post['level'];

            //Letakan Query Update approve disini
            if($lvl==1){
                $dataupdate['cSphu_app']= $this->user->gNIP;
                $dataupdate['dSphu_app']= date('Y-m-d H:i:s');
                $dataupdate['vSphu_app']= $post['vRemark'];
                $dataupdate['iSphu_app']= 1;

                $subject = 'e-Pengujian -> Reject SPHU Sertifikat '.$rsql['vNo_transaksi'];
                $precontent = 'Admin SPHU telah melakukan Approval Permintaan Permohonan Kontrak Pengujian Mutu Obat Hewan baru';



            }else if($lvl==2){
                $dataupdate['cTu_app']= $this->user->gNIP;
                $dataupdate['dTu_app']= date('Y-m-d H:i:s');
                $dataupdate['vTu_app']= $post['vRemark'];
                $dataupdate['iTu_app']= 1;

                $subject = 'e-Pengujian -> Reject SPHU Sertifikat '.$rsql['vNo_transaksi'];
                $precontent = 'Admin TU telah melakukan Approval Permintaan Permohonan Kontrak Pengujian Mutu Obat Hewan baru';

            }else{
                $dataupdate['cFa_app']= $this->user->gNIP;
                $dataupdate['dFa_app']= date('Y-m-d H:i:s');
                $dataupdate['vFa_app']= $post['vRemark'];
                $dataupdate['iFa_app']= 1;

                $subject = 'e-Pengujian -> Reject SPHU Sertifikat '.$rsql['vNo_transaksi'];
                $precontent = 'Admin Keuangan telah melakukan Konfirmasi Permintaan Permohonan Kontrak Pengujian Mutu Obat Hewan baru';
            }
	        
	        $updet = $this->db->where('iMt01',$post['iMt01'])->update('bbpmsoh.mt01',$dataupdate);

            if($updet){
                $qsql="
                        select * 
                        from bbpmsoh.mt01 a 
                        join hrd.employee b on b.cNip=a.iCustomer
                        join bbpmsoh.m_tujuan_pengujian c on c.iM_tujuan_pengujian=a.iM_tujuan_pengujian
                        where a.lDeleted=0 
                        and a.iMt01 = '".$iMt01."'

                ";
                $rsql = $this->db->query($qsql)->row_array();

                $iAm = $this->whoAmI($this->user->gNIP);

                $to = $rsql['cNip_requestor'] ;                        
                $cc = $iAm['cNip'] ;

                $sqlEmpAr = 'select * from bbpmsoh.sysparam a where a.vVariable="MAIL_SERTIFIKAT_APP"';
                $dEmpAr =  $this->db->query($sqlEmpAr)->row_array();
                $sq= $dEmpAr['vContent'];
                $dataTO = $this->db->query($sq)->result_array();

                $to = '0';
                foreach ($dataTO as $toto) {
                    $to .=','.$toto['cNip'];
                }

                $bccMail = 'select * from bbpmsoh.sysparam a where a.vVariable="MAIL_BCC"';
                $dBcc =  $this->db->query($bccMail)->row_array();

                $to = $to;
                $cc = $this->user->gNIP.','.$dBcc['vContent'];

                
                $content="
                        <p>Diberitahukan bahwa ".$precontent." yang membutuhkan Follow up, dengan rincian sebagai berikut : <p>
                        <br><br>  
                        <table border='1' style='width: 750px;border-collapse: collapse;'>
                            <tr>
                                    <td style='width: 30%;'><b>Nomor Transaksi</b></td>
                                    <td> : ".$rsql['vNo_transaksi']."</td>
                            </tr>

                            <tr>
                                    <td style='width: 30%;'><b>Nama Pemohon</b></td>
                                    <td> : ".$rsql['cNip'].' || '.$rsql['vName']."</td>
                            </tr>


                            <tr>
                                    <td><b>No Permintaan</b></td>
                                    <td> : ".$rsql['vNomor']."</td>
                            </tr> 
                            <tr>
                                    <td><b>Perihal</b></td>
                                    <td> :".$rsql['vPerihal']."</td>
                            </tr> 

                            <tr>
                                    <td><b>Nama Perusahaan</b></td>
                                    <td> : ".$rsql['vName_company']."</td>
                            </tr> 

                            <tr>
                                    <td><b>Alamat</b></td>
                                    <td> : ".nl2br($rsql['vAddress_company'])."</td>
                            </tr>

                            <tr>
                                    <td><b>Nama Produsen</b></td>
                                    <td> : ".$rsql['vNama_produsen']."</td>
                            </tr> 

                            <tr>
                                    <td><b>Alamat Produsen</b></td>
                                    <td> : ".nl2br($rsql['vAlamat_produsen'])."</td>
                            </tr>

                            <tr>
                                    <td><b>Tujuan Pengujian Mutu</b></td>
                                    <td> : ".$rsql['vNama_tujuan']."</td>
                            </tr>

                            <tr>
                                    <td><b>Nama Sample</b></td>
                                    <td> : ".$rsql['vNama_sample']."</td>
                            </tr>

                            <tr>
                                    <td><b>Status</b></td>
                                    <td> : Reject</td>
                            </tr>



                            <tr>
                                    <td><b>Lokasi Modul</b></td>
                                    <td> e-Pengujian -> Transaksi -> Sertifikat</td>
                            </tr>
                            
                        </table> 

                    <br/> <br/>
                    Demikian, mohon segera follow up  pada aplikasi e-Pengujian. Terimakasih.<br><br><br>
                    Post Master"; 

                    $this->sess_auth->send_message_erp($this->uri->segment_array(),$to, $cc, $subject, $content);


            }

            $data['status']  = true;
            $data['last_id'] = $post['iMt01'];
            return json_encode($data);
        }


    //Standart Setiap table harus memiliki dCreated , cCreated, dUpdated, cUpdated
    function before_insert_processor($row, $postData) {
        $postData['dCreated'] = date('Y-m-d H:i:s');
        $postData['cCreated']=$this->user->gNIP;


        if($postData['isdraft']==true){
            $postData['iSubmit_sertifikat']=0;
        } else{
            $postData['iSubmit_sertifikat']=1;
        } 


        return $postData;

    }
    function before_update_processor($row, $postData) {
        $postData['dUpdated'] = date('Y-m-d H:i:s');
        $postData['cUpdated'] = $this->user->gNIP;

        if($postData['isdraft']==true){
            $postData['iSubmit_sertifikat']=0;
        } else{
            $postData['iSubmit_sertifikat']=1;
        } 


        return $postData; 
    }    

    function after_insert_processor($fields, $id, $postData) {
        //Example After Insert
        /*
        $cNip = $this->sess_auth->gNIP; 
        $sql = 'Place Query In Here';
        $this->dbset->query($sql);
        */
    }

    function after_update_processor($fields, $id, $postData) {
        //Example After Update
        /*
        $cNip = $this->sess_auth->gNIP; 
        $sql = 'Place Query In Here';
        $this->dbset->query($sql);
        */
        $qsql="
                select * 
                from bbpmsoh.mt01 a 
                join hrd.employee b on b.cNip=a.iCustomer
                join bbpmsoh.m_tujuan_pengujian c on c.iM_tujuan_pengujian=a.iM_tujuan_pengujian
                where a.lDeleted=0 
                and a.iMt01 = '".$iMt01."'

        ";
        $rsql = $this->db->query($qsql)->row_array();


        /*if($postData['iSubmit_sertifikat']==1){
                $subject = 'e-Pengujian -> Submit Sertifikat '.$rsql['vNo_transaksi'];
                $precontent = 'Admin Yanji telah melakukan Submit status sertifikat ';

                $qsql="
                        select * 
                        from bbpmsoh.mt01 a 
                        join hrd.employee b on b.cNip=a.iCustomer
                        join bbpmsoh.m_tujuan_pengujian c on c.iM_tujuan_pengujian=a.iM_tujuan_pengujian
                        where a.lDeleted=0 
                        and a.iMt01 = '".$iMt01."'

                ";
                $rsql = $this->db->query($qsql)->row_array();

                $iAm = $this->whoAmI($this->user->gNIP);

                $to = $rsql['cNip_requestor'] ;                        
                $cc = $iAm['cNip'] ;

                $sqlEmpAr = 'select * from bbpmsoh.sysparam a where a.vVariable="MAIL_SERTIFIKAT_APP_OTHER"';
                $dEmpAr =  $this->db->query($sqlEmpAr)->row_array();
                $sq= $dEmpAr['vContent'];
                $dataTO = $this->db->query($sq)->result_array();

                $to = '0';
                foreach ($dataTO as $toto) {
                    $to .=','.$toto['cNip'];
                }

                $bccMail = 'select * from bbpmsoh.sysparam a where a.vVariable="MAIL_BCC"';
                $dBcc =  $this->db->query($bccMail)->row_array();

                $to = $to;
                $cc = $this->user->gNIP.','.$dBcc['vContent'];

                
                $content="
                        <p>Diberitahukan bahwa ".$precontent." yang membutuhkan Follow up, dengan rincian sebagai berikut : <p>
                        <br><br>  
                        <table border='1' style='width: 750px;border-collapse: collapse;'>
                            <tr>
                                    <td style='width: 30%;'><b>Nomor Transaksi</b></td>
                                    <td> : ".$rsql['vNo_transaksi']."</td>
                            </tr>

                            <tr>
                                    <td style='width: 30%;'><b>Nama Pemohon</b></td>
                                    <td> : ".$rsql['cNip'].' || '.$rsql['vName']."</td>
                            </tr>


                            <tr>
                                    <td><b>No Permintaan</b></td>
                                    <td> : ".$rsql['vNomor']."</td>
                            </tr> 
                            <tr>
                                    <td><b>Perihal</b></td>
                                    <td> :".$rsql['vPerihal']."</td>
                            </tr> 

                            <tr>
                                    <td><b>Nama Perusahaan</b></td>
                                    <td> :".$rsql['vName_company']."</td>
                            </tr> 

                            <tr>
                                    <td><b>Alamat</b></td>
                                    <td> : ".nl2br($rsql['vAddress_company'])."</td>
                            </tr>

                            <tr>
                                    <td><b>Nama Produsen</b></td>
                                    <td> :".$rsql['vNama_produsen']."</td>
                            </tr> 

                            <tr>
                                    <td><b>Alamat Produsen</b></td>
                                    <td> : ".nl2br($rsql['vAlamat_produsen'])."</td>
                            </tr>

                            <tr>
                                    <td><b>Tujuan Pengujian Mutu</b></td>
                                    <td> : ".$rsql['vNama_tujuan']."</td>
                            </tr>

                            <tr>
                                    <td><b>Nama Sample</b></td>
                                    <td> : ".$rsql['vNama_sample']."</td>
                            </tr>  
                            <tr>
                                    <td><b>Status</b></td>
                                    <td> : Approve</td>
                            </tr>

                            <tr>
                                    <td><b>Lokasi Modul</b></td>
                                    <td> e-Pengujian -> Transaksi -> Sertifikat</td>
                            </tr>
                            
                        </table> 

                    <br/> <br/>
                    Demikian, mohon segera follow up  pada aplikasi e-Pengujian. Terimakasih.<br><br><br>
                    Post Master"; 

                    $this->sess_auth->send_message_erp($this->uri->segment_array(),$to, $cc, $subject, $content);


            

        }*/


    }

    function manipulate_insert_button($buttons) { 
        //Load Javascript In Here 
        $cNip= $this->user->gNIP;
        $js = $this->load->view('js/standard_js');
        $js .= $this->load->view('js/upload_js');

        $iframe = '<iframe name="sertifikat_frame" id="sertifikat_frame" height="0" width="0"></iframe>';
        
        $save_draft = '<button onclick="javascript:save_draft_btn_multiupload(\'sertifikat\', \' '.base_url().'processor/pengujian/sertifikat?draft=true \',this,true )"  id="button_save_draft_sertifikat"  class="ui-button-text icon-save" >Save as Draft</button>';
        $save = '<button onclick="javascript:save_btn_multiupload(\'sertifikat\', \' '.base_url().'processor/pengujian/sertifikat?company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'modul_id='.$this->input->get('modul_id').' \',this,true )"  id="button_save_submit_sertifikat"  class="ui-button-text icon-save" >Save &amp; Submit</button>';

        

        $buttons['save'] = $iframe.$save_draft.$save.$js;
        
        return $buttons;
    }

    function manipulate_update_button($buttons, $rowData) { 
        $peka=$rowData['iMt01'];


        //Load Javascript In Here 
        $cNip= $this->user->gNIP;
        $js = $this->load->view('js/standard_js');
        $js .= $this->load->view('js/upload_js');

        $iframe = '<iframe name="sertifikat_frame" id="sertifikat_frame" height="0" width="0"></iframe>';
        
        $update_draft = '<button onclick="javascript:update_draft_btn(\'sertifikat\', \' '.base_url().'processor/pengujian/sertifikat?draft=true \',this,true )"  id="button_update_draft_sertifikat"  class="ui-button-text icon-save" >Update as Draft</button>';
        $update = '<button onclick="javascript:update_btn_back(\'sertifikat\', \' '.base_url().'processor/pengujian/sertifikat?company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'modul_id='.$this->input->get('modul_id').' \',this,true )"  id="button_update_submit_sertifikat"  class="ui-button-text icon-save" >Update &amp; Submit</button>';


        $cekMT6 = 'select * from bbpmsoh.mt06 a where a.iMt01 = "'.$peka.'"';
        $dMt06 = $this->db->query($cekMT6)->row_array();



        if($dMt06['iDist_virologi']==1 or $dMt06['iDist_bakteri']==1 ){
        	// biologik
        	$templatenya = 'sertifikatB.docx';

        }else{
        	// farmastetik
        	$templatenya = 'sertifikatF.docx';
        }

        $grid          = $this->url;
		$url           = $this->masterUrl;

        $btnUpk  = "<button class='ui-button icon-print' onClick='btnUpk_{$this->url}(\"{$url}\", \"{$grid}\", this)'>Print</button>";
		$btnUpk .= "<script>
						function btnUpk_{$this->url}(url, grid, dis) {

							custom_confirm('Print Dokumen ?', function() {
								template = '$templatenya';
								var loadFile = function(url, callback) {
									JSZipUtils.getBinaryContent(url, callback);
								}
								loadFile('../files/pengujian/template/'+template, function(err, content) {
									if (err) {throw e};

									$.ajax({
										url: url+'&action=getDataMemo',
										type: 'POST',
										dataType: 'json',
										data: '&id={$peka}',
										success: function(data) {

											doc = new Docxgen(content);

											doc.setData({
                                                'NAMA_LAB' : 'BBPMSOH',
                                                'ALAMAT_LAB' : 'Jl Raya Pembangunan Gunung Sindur, Gn. Sindur, Bogor, Jawa Barat 16340',
												'NAMA_PEMOHON' : data[0].NAMA_PEMOHON,
												'ALAMAT_PEMOHON' : data[0].ALAMAT_PEMOHON,
												'NAMA_PRODUSEN' : data[0].NAMA_PRODUSEN,
												'ALAMAT_PRODUSEN' : data[0].ALAMAT_PRODUSEN,
												'KADALUARSA' : data[0].KADALUARSA,
												'NOREG' : data[0].NOREG,
												'KEMASAN' : data[0].KEMASAN,
												'JENIS' : data[0].JENIS,
												'NOMOR_UJI' : data[0].NOMOR_UJI,
                                                'NAMA_DAGANG' : data[0].NAMA_DAGANG,
                                                'NOMOR_TRADING' : data[0].NOMOR_TRADING,
                                                'TANGGAL_TERIMA_CONTOH' : data[0].TANGGAL_TERIMA_CONTOH,

                                                'NOMOR1' : data[0].NOMOR1,
                                                'NOMOR2' : data[0].NOMOR2,

                                                'NOMOR3' : data[0].NOMOR3,
                                                'TANGGAL1' : data[0].TANGGAL1,

                                                'NOMOR5' : data[0].NOMOR5,
                                                'TANGGAL3' : data[0].TANGGAL3,

                                                'NOMOR4' : data[0].NOMOR4,
                                                'TANGGAL2' : data[0].TANGGAL2,

                                                'NOMOR6' : data[0].NOMOR6,
                                                'TANGGAL4' : data[0].TANGGAL4,

                                                'TTD1' : data[0].TTD1,
                                                'TTD2' : data[0].TTD2,

                                                'ACUAN' : data[0].ACUAN,

                                                'WARNA1' : data[0].WARNA1,
                                                'WARNA2' : data[0].WARNA2,
                                                'WARNA3' : data[0].WARNA3,
                                                'WARNA4' : data[0].WARNA4,


                                                'BAU1' : data[0].BAU1,
                                                'BAU2' : data[0].BAU2,
                                                'BAU3' : data[0].BAU3,
                                                'BAU4' : data[0].BAU4,



                                                'PARTIKEL_ASING1' : data[0].PARTIKEL_ASING1,
                                                'PARTIKEL_ASING2' : data[0].PARTIKEL_ASING2,
                                                'PARTIKEL_ASING3' : data[0].PARTIKEL_ASING3,
                                                'PARTIKEL_ASING4' : data[0].PARTIKEL_ASING4,

                                                'HOMOGENITAS1' : data[0].HOMOGENITAS1,
                                                'HOMOGENITAS2' : data[0].HOMOGENITAS2,
                                                'HOMOGENITAS4' : data[0].HOMOGENITAS4,
                                                'HOMOGENITAS3' : data[0].HOMOGENITAS3,

                                                'KEVAKUMAN1' : data[0].KEVAKUMAN1,
                                                'KEVAKUMAN2' : data[0].KEVAKUMAN2,
                                                'KEVAKUMAN4' : data[0].KEVAKUMAN4,
                                                'KEVAKUMAN3' : data[0].KEVAKUMAN3,

                                                'KELEMBABAN1' : data[0].KELEMBABAN1,
                                                'KELEMBABAN2' : data[0].KELEMBABAN2,
                                                'KELEMBABAN4' : data[0].KELEMBABAN4,
                                                'KELEMBABAN3' : data[0].KELEMBABAN3,

                                                'KEMURNIAN1' : data[0].KEMURNIAN1,
                                                'KEMURNIAN2' : data[0].KEMURNIAN2,
                                                'KEMURNIAN4' : data[0].KEMURNIAN4,
                                                'KEMURNIAN3' : data[0].KEMURNIAN3,

                                                'STERIL1' : data[0].STERIL1,
                                                'STERIL2' : data[0].STERIL2,
                                                'STERIL4' : data[0].STERIL4,
                                                'STERIL3' : data[0].STERIL3,

                                                'MYCROPLASMA1' : data[0].MYCROPLASMA1,
                                                'MYCROPLASMA2' : data[0].MYCROPLASMA2,
                                                'MYCROPLASMA3' : data[0].MYCROPLASMA3,
                                                'MYCROPLASMA4' : data[0].MYCROPLASMA4,

                                                'SALMONELLA1' : data[0].SALMONELLA1,
                                                'SALMONELLA2' : data[0].SALMONELLA2,
                                                'SALMONELLA3' : data[0].SALMONELLA3,
                                                'SALMONELLA4' : data[0].SALMONELLA4,

                                                'COLI1' : data[0].COLI1,
                                                'COLI2' : data[0].COLI2,
                                                'COLI3' : data[0].COLI3,
                                                'COLI4' : data[0].COLI4,

                                                'JAMUR1' : data[0].JAMUR1,
                                                'JAMUR2' : data[0].JAMUR2,
                                                'JAMUR3' : data[0].JAMUR3,
                                                'JAMUR4' : data[0].JAMUR4,

                                                'ORGANISME1' : data[0].ORGANISME1,
                                                'ORGANISME2' : data[0].ORGANISME2,
                                                'ORGANISME3' : data[0].ORGANISME3,
                                                'ORGANISME4' : data[0].ORGANISME4,

                                                'BAKTERI1' : data[0].BAKTERI1,
                                                'BAKTERI2' : data[0].BAKTERI2,
                                                'BAKTERI3' : data[0].BAKTERI3,
                                                'BAKTERI4' : data[0].BAKTERI4,

                                                'IDENTITAS1' : data[0].IDENTITAS1,
                                                'IDENTITAS2' : data[0].IDENTITAS2,
                                                'IDENTITAS3' : data[0].IDENTITAS3,
                                                'IDENTITAS4' : data[0].IDENTITAS4,

                                                'INAKTIF1' : data[0].INAKTIF1,
                                                'INAKTIF2' : data[0].INAKTIF2,
                                                'INAKTIF3' : data[0].INAKTIF3,
                                                'INAKTIF4' : data[0].INAKTIF4,

                                                'TOXIC1' : data[0].TOXIC1,
                                                'TOXIC2' : data[0].TOXIC2,
                                                'TOXIC3' : data[0].TOXIC3,
                                                'TOXIC4' : data[0].TOXIC4,

                                                'KEAMANAN1' : data[0].KEAMANAN1,

                                                'POTENSI' : data[0].POTENSI,
                                                'POTENSI1' : data[0].POTENSI1,
                                                'POTENSI2' : data[0].POTENSI2,
                                                'POTENSI3' : data[0].POTENSI3,
                                                'POTENSI4' : data[0].POTENSI4,

                                                'LAIN1' : data[0].LAIN1,
                                                'LAIN2' : data[0].LAIN2,
                                                'LAIN3' : data[0].LAIN3,
                                                'LAIN4' : data[0].LAIN4,


                                                'KEASAMAN1' : data[0].KEASAMAN1,
                                                'KEASAMAN2' : data[0].KEASAMAN2,
                                                'KEASAMAN3' : data[0].KEASAMAN3,
                                                'KEASAMAN4' : data[0].KEASAMAN4,

                                                'KELARUTAN1' : data[0].KELARUTAN1,
                                                'KELARUTAN2' : data[0].KELARUTAN2,
                                                'KELARUTAN3' : data[0].KELARUTAN3,
                                                'KELARUTAN4' : data[0].KELARUTAN4,

                                                'STERIL1a' : data[0].STERIL1a,
                                                'STERIL2a' : data[0].STERIL2a,
                                                'STERIL4a' : data[0].STERIL4a,
                                                'STERIL3a' : data[0].STERIL3a,

                                                'PIROGENITAS1' : data[0].PIROGENITAS1,
                                                'PIROGENITAS2' : data[0].PIROGENITAS2,
                                                'PIROGENITAS3' : data[0].PIROGENITAS3,
                                                'PIROGENITAS4' : data[0].PIROGENITAS4,

                                                'KADAR' : data[0].KADAR,
                                                'KADAR1' : data[0].KADAR1,
                                                'KADAR2' : data[0].KADAR2,
                                                'KADAR3' : data[0].KADAR3,
                                                'KADAR4' : data[0].KADAR4,



                                                'PENILAIAN' : data[0].PENILAIAN

		    									
											})

											doc.render()
		    								out = doc.getZip().generate({type:'blob'})

		    								nmdok = 'Sertifikat';
		    								saveAs(out, nmdok+' - ' + data[0].NOMOR_UJI + '.docx')
										}
									})
								})
							})
						}
					</script>";


        if ($this->input->get('action') == 'view') {
            unset($buttons['update']);
            $buttons['update'] = $btnUpk;    
            
        }
        else{ 
        	unset($buttons['update']);
        	 /*
            idprivi_group;vNamaGroup
			1;Administrator
			2;Admini Yanji
			3;Admin Biologik
			4;Admin Virologi
			5;Admin Farmastetik & Premiks
			6;Admin SPHU
			7;Customer
			8;Kepala Balai
			9;TU
			10;Keuangan



        */ 

        	$groupnya = $this->checkgroup($this->user->gNIP);             
	        if( $groupnya['idprivi_group']== 2 and $rowData['iSubmit_sertifikat']==0 ){
	            $buttons['update'] = $iframe.$update_draft.$update.$js;    
	        }else if($groupnya['idprivi_group']== 6 and $rowData['iSubmit_sertifikat']==1 and $rowData['iSphu_app']==0){
	        	$approve = '<button onclick="javascript:load_popup(\' '.base_url().'processor/pengujian/sertifikat?action=approve&level=1&iMt01='.$peka.'&company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').' \')"  id="button_approve_sertifikat"  class="ui-button-text icon-save" >Approve</button>';
        		$reject = '<button onclick="javascript:load_popup(\' '.base_url().'processor/pengujian/sertifikat?action=reject&level=1&iMt01='.$peka.'&company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').' \' )"  id="button_reject_sertifikat"  class="ui-button-text icon-save" >Reject</button>';
        		$buttons['update'] = $iframe.$approve.$reject;    

	        }else if($groupnya['idprivi_group']== 9 and $rowData['iSphu_app']==2 and $rowData['iTu_app']==0){
	        	$approve = '<button onclick="javascript:load_popup(\' '.base_url().'processor/pengujian/sertifikat?action=approve&level=2&iMt01='.$peka.'&company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').' \')"  id="button_approve_sertifikat"  class="ui-button-text icon-save" >Approve</button>';
        		$reject = '<button onclick="javascript:load_popup(\' '.base_url().'processor/pengujian/sertifikat?action=reject&level=2&iMt01='.$peka.'&company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').' \' )"  id="button_reject_sertifikat"  class="ui-button-text icon-save" >Reject</button>';
        		$buttons['update'] = $iframe.$approve.$reject;    
	        }else if($groupnya['idprivi_group']== 10 and $rowData['iTu_app']==2 and $rowData['iFa_app']==0){
	        	$approve = '<button onclick="javascript:load_popup(\' '.base_url().'processor/pengujian/sertifikat?action=approve&level=3&iMt01='.$peka.'&company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').' \')"  id="button_approve_sertifikat"  class="ui-button-text icon-save" >Confirm</button>';
        		$reject = '<button onclick="javascript:load_popup(\' '.base_url().'processor/pengujian/sertifikat?action=reject&level=3&iMt01='.$peka.'&company_id='.$this->input->get('company_id').'&group_id='.$this->input->get('group_id').'&modul_id='.$this->input->get('modul_id').' \' )"  id="button_reject_sertifikat"  class="ui-button-text icon-save" >Reject</button>';
        		$buttons['update'] = $iframe.$approve;    
	        }

            
        }
        
        return $buttons;
    }

    function whoAmI($nip) { 
        $sql = 'select b.vDescription as vdepartemen,a.*,b.*
                        from hrd.employee a 
                        join hrd.msdepartement b on b.iDeptID=a.iDepartementID
                        join hrd.position c on c.iPostId=a.iPostID
                        where a.cNip ="'.$nip.'"
                        ';
        
        $data = $this->db->query($sql)->row_array();
        return $data;
    }

    function download($vFilename) { 
        $this->load->helper('download');        
        $name = $vFilename;
        $id = $_GET['id'];
        $tempat = $_GET['path'];    
        $path = file_get_contents('./files/pengujian/'.$tempat.'/'.$id.'/'.$name);    
        force_download($name, $path);


    }

    //Output
    public function output(){
        $this->index($this->input->get('action'));
    }

}
